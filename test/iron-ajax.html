<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Test Iron AJAX</title>
    <meta name="description" content="Test Iron AJAX">

    <!-- Mobile -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <!-- Chrome / Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="black">

    <!-- Safari / iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png">

    <!-- Web Components -->
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
  </head>
  <body>
    <test-fixture id="simple-get">
      <template>
        <iron-ajax url="/responds_to_get_with_json"></iron-ajax>
      </template>
    </test-fixture>
    <test-fixture id="simple-post">
      <template>
        <iron-ajax method="POST" url="/responds_to_post_with_json"></iron-ajax>
      </template>
    </test-fixture>
    <script>
     suite('<iron-ajax>', function(){
       var ajax
       var request;
       var server;
       var responseHeaders = {
         json: {'Content-Type': 'application/json'}
       }
       setup(function(){
         server = sinon.fakeServer.create();
         server.respondWith(
           'GET',
           /\/responds_to_get_with_json.*/,[
             200,
             responseHeaders.json,
             '{"success":true}'
           ]
         );
         server.respondWith(
           'POST',
           /\/responds_to_post_with_json.*/,[
             200,
             responseHeaders.json,
             '{"post_success":true}'
           ]
         );
       });
       teardown(function(){
         server.restore();
       });
       suite('when making simple GET requests for JSON', function() {
         setup(function() {
           ajax = fixture('simple-get');
         });

         test('has sane defaults that love you', function() {
           request = ajax.generateRequest();
           server.respond();
           expect(request.response).to.be.ok;
           expect(request.response).to.be.an('object');
           expect(request.response.success).to.be.equal(true);
         });
       });
       suite('when making simple GET requests for JSON', function() {
         setup(function() {
           ajax = fixture('simple-post');
         });

         test('has the correct xhr method', function(){
           request = ajax.generateRequest();
           expect(request.xhr.method).to.be.equal('POST');
         });

         test('has sane defaults that love you', function() {
           request = ajax.generateRequest();
           server.respond();
           expect(request.response).to.be.ok;
           expect(request.response).to.be.an('object');
           expect(request.response.post_success).to.be.equal(true);
         });
       });

     });
    </script>
  </body>
</html>
